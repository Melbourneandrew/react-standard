{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Playwright selector mappings for test generation",

  "testStructure": {
    "fileMapping": "1:1 mapping between feature files and test files",
    "featureToTest": {
      "collections.feature": "collections.spec.ts",
      "error-handling.feature": "error-handling.spec.ts",
      "item-create.feature": "item-create.spec.ts",
      "item-delete.feature": "item-delete.spec.ts",
      "item-edit.feature": "item-edit.spec.ts",
      "item-view.feature": "item-view.spec.ts",
      "items-list.feature": "items-list.spec.ts",
      "items-pagination.feature": "items-pagination.spec.ts",
      "items-search.feature": "items-search.spec.ts"
    },
    "sharedBeforeEach": {
      "appliesTo": ["item-create", "item-view", "item-edit", "item-delete"],
      "navigateTo": "/collections/coll-1",
      "waitFor": "loading spinner to disappear"
    }
  },

  "routes": {
    "home": "/",
    "collection": "/collections/:id"
  },

  "urlParams": {
    "searchQuery": "query",
    "page": "page"
  },

  "api": {
    "itemsEndpoint": "/api/collections/:id/items",
    "mockRoutePattern": "**/api/collections/*/items*",
    "responseFormat": {
      "fieldNaming": "snake_case",
      "listResponse": {
        "items": "array of item objects",
        "total_count": "number",
        "page": "number",
        "page_size": "number",
        "total_pages": "number"
      },
      "itemObject": {
        "id": "string",
        "name": "string",
        "description": "string | undefined",
        "collection_id": "string",
        "created_at": "ISO date string",
        "updated_at": "ISO date string"
      }
    }
  },

  "mockData": {
    "collectionIds": ["coll-1", "coll-2", "coll-3", "coll-4", "coll-5"],
    "itemsPerCollection": 100,
    "itemsPerPage": 10,
    "totalPages": 10
  },

  "elements": {
    "collectionDropdown": {
      "role": "combobox",
      "description": "Radix Select trigger for collection selection",
      "multipleInstances": {
        "homePage": true,
        "navbar": ".first()",
        "welcomeCard": ".nth(1)"
      }
    },
    "collectionOptions": {
      "role": "listbox",
      "childRole": "option",
      "description": "Collection dropdown options"
    },
    "searchInput": {
      "placeholder": "Search...",
      "debounceMs": 300
    },
    "loadingSpinner": {
      "selector": ".animate-spin"
    },
    "itemCard": {
      "selector": ".rounded-lg.border"
    },
    "itemName": {
      "selector": "h3",
      "parent": "itemCard"
    },
    "itemDescription": {
      "selector": "p.text-sm.text-muted-foreground",
      "parent": "itemCard",
      "conditional": "only rendered if item has description"
    },
    "itemsCount": {
      "pattern": "/\\d+ items?/"
    },
    "emptyState": {
      "text": "No items found"
    },
    "pageInfo": {
      "pattern": "/Page \\d+ of \\d+/"
    }
  },

  "buttons": {
    "createItem": {
      "selector": "button:has(svg.lucide-plus)",
      "description": "Plus icon button next to search"
    },
    "viewItem": {
      "selector": "button:has(svg.lucide-eye)",
      "parent": "itemCard",
      "description": "Eye icon - view item details"
    },
    "editItem": {
      "selector": "button:has(svg.lucide-pencil)",
      "parent": "itemCard",
      "description": "Pencil icon - edit item"
    },
    "deleteItem": {
      "selector": "button:has(svg.lucide-trash-2)",
      "parent": "itemCard",
      "description": "Trash icon - delete item"
    },
    "previousPage": {
      "role": "button",
      "name": "Previous"
    },
    "nextPage": {
      "role": "button",
      "name": "Next",
      "exact": true,
      "note": "Must use exact:true due to Next.js dev tools button conflict"
    }
  },

  "dialogs": {
    "role": "dialog",
    "closeMethods": ["cancelButton", "escapeKey", "clickOutside"],
    "formFields": {
      "name": {
        "label": "Name",
        "required": true
      },
      "description": {
        "label": "Description",
        "required": false
      }
    },
    "viewDialogLabels": {
      "title": "h2 element shows item name after loading",
      "description": "Description (conditional - only if item has description)",
      "createdDate": "Created",
      "updatedDate": "Last Updated"
    },
    "loadingState": {
      "title": "Loading..."
    },
    "errorState": {
      "title": "Error"
    },
    "actions": {
      "create": {
        "pattern": "/create/i",
        "usedIn": "item-create dialog"
      },
      "save": {
        "pattern": "/save/i",
        "usedIn": "item-edit dialog"
      },
      "delete": {
        "pattern": "/delete/i",
        "usedIn": "item-delete confirmation dialog"
      },
      "cancel": {
        "pattern": "/cancel/i",
        "usedIn": "all dialogs"
      },
      "close": {
        "name": "Close",
        "usedIn": "item-view dialog"
      }
    }
  },

  "quirks": {
    "nextButtonConflict": {
      "issue": "Next.js dev tools button has 'Next' in accessible name",
      "solution": "Use { exact: true } for pagination Next button",
      "affectedSelector": "nextPage"
    },
    "paginationVisibility": {
      "issue": "Pagination controls only render when totalPages > 1",
      "solution": "Tests checking for hidden pagination must mock API to return totalPages: 1"
    },
    "optionalDescription": {
      "issue": "Description field is optional, UI elements conditional",
      "locations": ["item card description paragraph", "view dialog description label"]
    },
    "routeMockingWithBeforeEach": {
      "issue": "beforeEach navigates before test can set up route mocks",
      "solution": "Use separate describe block without beforeEach for tests needing route mocks"
    }
  },

  "timeouts": {
    "itemsLoading": 10000,
    "collectionDropdown": 10000,
    "searchUrlUpdate": 5000,
    "dialogClose": 10000,
    "dialogCloseAfterMutation": 15000,
    "searchResults": 10000,
    "default": 5000
  },

  "notes": {
    "multipleComboboxes": "Home page has TWO comboboxes (navbar + welcome card). Use .first() or .nth(1) to disambiguate.",
    "mutationTiming": "After mutations (create/update/delete), wait for cache invalidation before asserting on updated data.",
    "invalidCollectionId": "Invalid collection IDs still render the items page (with empty/error state), not a dedicated 'not found' page.",
    "snakeCaseApi": "API uses snake_case field names (total_count, page_size, total_pages, collection_id, created_at, updated_at)",
    "uniqueTestData": "Use Date.now() for unique names in create/update tests to avoid conflicts in parallel execution"
  }
}
